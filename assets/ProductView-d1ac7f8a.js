import{_ as Q,ao as W,U as X,W as Z,X as Y,Z as p,ag as ee,G as v,K as $,o as a,J as l,ap as ae,aq as te,L as F,a2 as le,T as u,Q as x,H as k,N as se,a0 as I,a1 as r,am as L,O as y,P as V,ai as oe,ar as re,as as ne,an as h,q as T,at as ue,au as ie,R as de,S as ce}from"./index-4779d971.js";import{c as me,f as pe,a as ve,h as Ve,u as ge,e as N,V as R}from"./index.esm-115d3317.js";import{V as fe,a as A,b as g}from"./VRow-97cf97ad.js";import{V as _e,a as be}from"./VCarouselItem-0a4d17d8.js";import{V as ye,a as he}from"./VCombobox-3d8adc62.js";import{V as we}from"./filter-2c7165d1.js";import{a as Ce}from"./VList-799d58f5.js";import{V as xe}from"./VTextarea-4e876632.js";import"./ssrBoot-f9dd270b.js";import"./VCheckboxBtn-f51645e7.js";import"./VSlideGroup-ca1d0385.js";import"./VDivider-759e14d2.js";const w=i=>(de("data-v-d63cb07b"),i=i(),ce(),i),ke={class:"my-3",style:{"white-space":"pre-wrap"}},Se=w(()=>u("div",null," ",-1)),qe=w(()=>u("div",null," ",-1)),Be=w(()=>u("h1",{class:"textdown"},"已下架",-1)),Pe=w(()=>u("div",null," ",-1)),Ue={__name:"ProductView",props:["_id","category","description","image","name","price","sell"],setup(i){const D=W(),f=X(),{api:H,apiAuth:S}=le(),d=Z(),c=Y(),s=p({_id:"",name:"",price:0,description:"",image:"",sell:!0,category:""}),q=i,M=me({quantity:pe().typeError("格式錯誤").required("缺少數量").min(1,"數量最少為 1"),name:ve().required("缺少師傅姓名"),date:Ve().required("請選擇日期")}),{isSubmitting:m,handleSubmit:E,resetForm:O}=ge({validationSchema:M,initialValues:{name:q.name,price:q.price,quantity:1,description:"",date:""}}),_=N("quantity"),B=E(async n=>{var t,e;if(!c.isLogin){f.push("/login");return}try{const{data:o}=await S.patch("/users/cart",{product:s.value._id,quantity:n.quantity});c.cart=o.result,d({text:"新增成功",showCloseButton:!1,snackbarProps:{timeout:1500,color:"#8C8987",location:"center"}}),C()}catch(o){console.log(o);const K=((e=(t=o==null?void 0:o.response)==null?void 0:t.data)==null?void 0:e.message)||"發生錯誤，請稍後再試";d({text:K,showCloseButton:!1,snackbarProps:{timeout:1500,color:"error",location:"center"}})}}),j=async()=>{var n,t;if(!c.isLogin){f.push("/login");return}try{const{data:e}=await S.patch("/users/cart",{product:s.value._id,quantity:_.value.value});c.cart=e.result,d({text:"新增成功",showCloseButton:!1,snackbarProps:{timeout:1500,color:"#8C8987",location:"center"}}),C()}catch(e){console.log(e);const o=((t=(n=e==null?void 0:e.response)==null?void 0:n.data)==null?void 0:t.message)||"發生錯誤，請稍後再試";d({text:o,showCloseButton:!1,snackbarProps:{timeout:1500,color:"error",location:"center"}})}};ee(async()=>{var n,t;try{const{data:e}=await H.get("/products/"+D.params._id);s.value._id=e.result._id,s.value.name=e.result.name,s.value.price=e.result.price,s.value.description=e.result.description,s.value.image=e.result.image,s.value.sell=e.result.sell,s.value.category=e.result.category,document.title=`出來喬師傅 | ${s.value.name}`}catch(e){console.log(e);const o=((t=(n=e==null?void 0:e.response)==null?void 0:n.data)==null?void 0:t.message)||"發生錯誤，請稍後再試";d({text:o,showCloseButton:!1,snackbarProps:{timeout:1500,color:"error",location:"center"}}),f.push("/")}});const b=p(!1),z=()=>{if(!c.isLogin){f.push("/login");return}b.value=!0},C=()=>{b.value=!1,O()},P=N("description"),U=p(),G=p(!1),J=p([{names:" 頭 "},{names:" 頸 "},{names:" 肩 "},{names:" 背 "},{names:" 手 "},{names:" 臀 "},{names:" 腿 "},{names:" 腳底 "},{names:" 上半身 "},{names:" 下半身 "},{names:" 全身 "}]);return(n,t)=>(v(),$(F,null,[a(fe,null,{default:l(()=>[a(A,null,{default:l(()=>[a(g,{class:"titel",cols:"12"},{default:l(()=>[u("h1",null,x(s.value.name),1)]),_:1}),a(g,{cols:"12",md:"6"},{default:l(()=>[s.value.image&&s.value.image.length>0?(v(),k(_e,{key:0,"show-arrows":"hover","hide-delimiters":"",progress:"#403635"},{default:l(()=>[(v(!0),$(F,null,se(s.value.image,(e,o)=>(v(),k(be,{key:o,src:e},null,8,["src"]))),128))]),_:1})):I("",!0)]),_:1}),a(g,{class:"my-auto",cols:"12",md:"6"},{default:l(()=>[u("h2",null,"1HR   $ "+x(s.value.price),1),u("p",ke,x(s.value.description),1),Se,a(R,{disabled:r(m),onSubmit:L(r(B),["prevent"])},{default:l(()=>[qe,a(y,{class:"cart-btn",type:"submit","prepend-icon":"mdi-clock-time-three-outline",loading:r(m),onClick:t[0]||(t[0]=e=>z())},{default:l(()=>[V("選擇時段")]),_:1},8,["loading"])]),_:1},8,["disabled","onSubmit"])]),_:1})]),_:1})]),_:1}),a(ae,{class:"align-center justify-center text-center","model-value":!s.value.sell,persistent:""},{default:l(()=>[Be,Pe,a(y,{class:"color",to:"/",block:"",rounded:"xl",elevation:"20",size:"x-large"},{default:l(()=>[V("回首頁")]),_:1})]),_:1},8,["model-value"]),a(te,{class:"w-75",modelValue:b.value,"onUpdate:modelValue":t[6]||(t[6]=e=>b.value=e)},{default:l(()=>[s.value._id.length>0?(v(),k(R,{key:0,disabled:r(m),onSubmit:L(r(B),["prevent"])},{default:l(()=>[a(oe,null,{default:l(()=>[a(re,null,{default:l(()=>[V("選擇師傅")]),_:1}),a(ne,null,{default:l(()=>[a(h,{modelValue:s.value.name,"onUpdate:modelValue":t[1]||(t[1]=e=>s.value.name=e),variant:"outlined",disabled:""},null,8,["modelValue"]),a(h,{label:"價格/1H",modelValue:s.value.price,"onUpdate:modelValue":t[2]||(t[2]=e=>s.value.price=e),disabled:""},null,8,["modelValue"]),a(ye,{modelValue:U.value,"onUpdate:modelValue":t[3]||(t[3]=e=>U.value=e),disabled:G.value,items:J.value,chips:"","closable-chips":"",color:"blue-grey-lighten-2","item-title":"names","item-value":"names",multiple:"",label:"部位選擇"},{chip:l(({props:e,item:o})=>[a(we,T(e,{"prepend-avatar":o.raw.avatar,text:o.raw.names}),null,16,["prepend-avatar","text"])]),item:l(({props:e,item:o})=>[a(Ce,T(e,{"prepend-avatar":o.raw.avatar,title:o.raw.names,subtitle:o.raw.group}),null,16,["prepend-avatar","title","subtitle"])]),_:1},8,["modelValue","disabled","items"]),a(he,{label:"時段選擇",items:["中午時段","下午時段","晚上時段"]}),a(xe,{label:"備註",modelValue:r(P).value.value,"onUpdate:modelValue":t[4]||(t[4]=e=>r(P).value.value=e)},null,8,["modelValue"]),a(A,null,{default:l(()=>[a(g,{cols:"6"},{default:l(()=>[a(h,{label:"時數",type:"text",inputmode:"numeric",min:"0",modelValue:r(_).value.value,"onUpdate:modelValue":t[5]||(t[5]=e=>r(_).value.value=e),"error-messages":r(_).errorMessage.value,clearable:""},null,8,["modelValue","error-messages"])]),_:1}),a(g,{cols:"6"},{default:l(()=>[a(h,{type:"date"})]),_:1})]),_:1})]),_:1}),a(ue,null,{default:l(()=>[a(ie),a(y,{color:"red",disabled:r(m),onClick:C},{default:l(()=>[V("取消")]),_:1},8,["disabled"]),a(y,{color:"green",type:"submit",loading:r(m),onClick:j},{default:l(()=>[V("送出")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])):I("",!0)]),_:1},8,["modelValue"])],64))}},Oe=Q(Ue,[["__scopeId","data-v-d63cb07b"]]);export{Oe as default};
