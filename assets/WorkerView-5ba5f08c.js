import{p as Pe,g as ke,D as W,t as C,aL as we,a3 as xe,l as Se,o as l,L as ye,q as Z,_ as Te,Y as Ce,Z as v,W as De,$ as Be,G as O,K as Me,J as r,H as X,aq as te,a2 as Ie,O as F,P as D,an as E,aM as Ue,ak as he,a0 as _e,ai as oe,ar as se,Q as re,as as ue,a1 as t,at as ne,au as de,am as ie,V as Fe,R as Re,S as Ae,T as qe}from"./index-775ca1ee.js";import{c as He,a as ee,f as Le,d as $e,u as Ee,e as G,V as me}from"./index.esm-b06ce4fb.js";import{a as Ge,V as Ne,b as ae}from"./VRow-453d8268.js";import{m as Oe,a as We,b as je,c as ze,d as Ke,e as Je,f as Qe,u as Ye,p as Ze,g as Xe,h as ea,i as aa,j as la,k as ta,l as oa,n as ve,o as pe,q as ge,r as ce}from"./VDataTable-d65fbf9f.js";import{a as be}from"./filter-932b5e6a.js";import{V as Ve}from"./VCheckbox-57cd58d5.js";import{V as fe}from"./VTextarea-92c6683f.js";import"./VCheckboxBtn-53b4c851.js";import"./VDivider-ee7db21c.js";import"./VList-7df298df.js";import"./ssrBoot-3bb5178d.js";import"./VSlideGroup-2a90fa20.js";const sa=Pe({itemsLength:{type:[Number,String],required:!0},...Oe(),...We(),...je()},"VDataTableServer"),ra=ke()({name:"VDataTableServer",props:sa(),emits:{"update:modelValue":o=>!0,"update:page":o=>!0,"update:itemsPerPage":o=>!0,"update:sortBy":o=>!0,"update:options":o=>!0,"update:expanded":o=>!0,"update:groupBy":o=>!0},setup(o,j){let{attrs:z,slots:s}=j;const{groupBy:w}=ze(o),{sortBy:c,multiSort:R,mustSort:x}=Ke(o),{page:i,itemsPerPage:B}=Je(o),A=W(()=>parseInt(o.itemsLength,10)),{columns:M,headers:K}=Qe(o,{groupBy:w,showSelect:C(o,"showSelect"),showExpand:C(o,"showExpand")}),{items:I}=Ye(o,M),{toggleSort:b}=Ze({sortBy:c,multiSort:R,mustSort:x,page:i}),{opened:J,isGroupOpen:V,toggleGroup:f,extractRows:y}=Xe({groupBy:w,sortBy:c}),{pageCount:P,setItemsPerPage:k}=ea({page:i,itemsPerPage:B,itemsLength:A}),{flatItems:d}=aa(I,w,J),{isSelected:U,select:N,selectAll:q,toggleSelect:Q,someSelected:h,allSelected:_}=la(o,{allItems:I,currentPage:I}),{isExpanded:H,toggleExpand:Y}=ta(o),L=W(()=>y(I.value));oa({page:i,itemsPerPage:B,sortBy:c,groupBy:w,search:C(o,"search")}),we("v-data-table",{toggleSort:b,sortBy:c}),xe({VDataTableRows:{hideNoData:C(o,"hideNoData"),noDataText:C(o,"noDataText"),loading:C(o,"loading"),loadingText:C(o,"loadingText")}});const m=W(()=>({page:i.value,itemsPerPage:B.value,sortBy:c.value,pageCount:P.value,toggleSort:b,setItemsPerPage:k,someSelected:h.value,allSelected:_.value,isSelected:U,select:N,selectAll:q,toggleSelect:Q,isExpanded:H,toggleExpand:Y,isGroupOpen:V,toggleGroup:f,items:L.value.map(S=>S.raw),internalItems:L.value,groupedItems:d.value,columns:M.value,headers:K.value}));Se(()=>{const S=ve.filterProps(o),T=pe.filterProps(o),$=ge.filterProps(o),n=ce.filterProps(o);return l(ce,Z({class:["v-data-table",{"v-data-table--loading":o.loading},o.class],style:o.style},n),{top:()=>{var a;return(a=s.top)==null?void 0:a.call(s,m.value)},default:()=>{var a,p,e,u,g,le;return s.default?s.default(m.value):l(ye,null,[(a=s.colgroup)==null?void 0:a.call(s,m.value),l("thead",{class:"v-data-table__thead",role:"rowgroup"},[l(pe,Z(T,{sticky:o.fixedHeader}),s)]),(p=s.thead)==null?void 0:p.call(s,m.value),l("tbody",{class:"v-data-table__tbody",role:"rowgroup"},[(e=s["body.prepend"])==null?void 0:e.call(s,m.value),s.body?s.body(m.value):l(ge,Z(z,$,{items:d.value}),s),(u=s["body.append"])==null?void 0:u.call(s,m.value)]),(g=s.tbody)==null?void 0:g.call(s,m.value),(le=s.tfoot)==null?void 0:le.call(s,m.value)])},bottom:()=>s.bottom?s.bottom(m.value):l(ve,S,{prepend:s["footer.prepend"]})})})}});const ua=o=>(Re("data-v-c3b38176"),o=o(),Ae(),o),na=ua(()=>qe("h1",{class:"text-center"},"師傅管理",-1)),da={__name:"WorkerView",setup(o){const{mobile:j}=Ce(),z=W(()=>j.value),s=v(!1),{apiAuth:w}=Ie(),c=De(),R=v(null),x=v(!1),i=v(""),B=n=>{n?(i.value=n._id,V.value.value=n.name,f.value.value=n.price,y.value.value=n.description,P.value.value=n.category,k.value.value=n.sell):i.value="",x.value=!0,s.value=!0},A=()=>{for(x.value=!1,J();d.value.length>0;)R.value.deleteFileRecord(d.value[0])},M=["生理男","生理女"],K=He({name:ee().required("缺少師傅姓名"),price:Le().typeError("商品價格格式錯誤").required("缺少時段價格").min(0,"價格不能小於0"),description:ee().required("缺少師傅說明"),category:ee().required("缺少類別分類").test("isCategory","商品分類錯誤",n=>M.includes(n)),sell:$e()}),{handleSubmit:I,isSubmitting:b,resetForm:J}=Ee({validationSchema:K,initialValues:{name:"",price:0,description:"",category:"",sell:!1}}),V=G("name"),f=G("price"),y=G("description"),P=G("category"),k=G("sell"),d=v([]),U=v([]),N=I(async n=>{var a,p,e;if(!(d.value>0&&((a=d.value[0])!=null&&a.error))&&!(i.value===""&&d.value.length===0))try{const u=new FormData;for(const g in n)u.append(g,n[g]);if(d.value.length>0)for(const g of d.value)u.append("image",g.file);i.value===""?await w.post("/products",u):await w.patch("/products/"+i.value,u),c({text:i.value===""?"新增成功":"編輯成功",showCloseButton:!1,snackbarProps:{timeout:1500,color:"#8C8987",location:"center"}}),A(),$()}catch(u){console.log(u);const g=((e=(p=u==null?void 0:u.response)==null?void 0:p.data)==null?void 0:e.message)||"發生錯誤，請稍後再試";c({text:g,showCloseButton:!1,snackbarProps:{timeout:1500,color:"error",location:"center"}})}}),q=v(5),Q=[{value:5,title:"5"},{value:10,title:"10"},{value:25,title:"25"},{value:50,title:"50"},{value:100,title:"100"},{value:-1,title:"$vuetify.dataFooter.itemsPerPageAll"}],h=v([{key:"name",order:"desc"}]),_=v(1),H=v([]),Y=[{title:"圖片",align:"center",sortable:!1,key:"image[0]"},{title:"名稱",align:"center",sortable:!0,key:"name"},{title:"價格",align:"center",sortable:!0,key:"price"},{title:"分類",align:"center",sortable:!0,key:"category"},{title:"上架",align:"center",sortable:!0,key:"sell"},{title:"編輯",align:"center",sortable:!1,key:"edit"}],L=v(!0),m=v(0),S=v(""),T=async()=>{var n,a,p,e;T.value=!0;try{const{data:u}=await w.get("/products/all",{params:{page:_.value,itemsPerPage:q.value,sortBy:((n=h.value[0])==null?void 0:n.key)||"name",sortOrder:((a=h.value[0])==null?void 0:a.order)==="asc"?1:-1,search:S.value}});H.value.splice(0,H.value.length,...u.result.data),m.value=u.result.total}catch(u){console.log(u);const g=((e=(p=u==null?void 0:u.response)==null?void 0:p.data)==null?void 0:e.message)||"發生錯誤，請稍後再試";c({text:g,showCloseButton:!1,snackbarProps:{timeout:2e3,color:"red",location:"center"}})}L.value=!1};T();const $=()=>{_.value=1,T()};return(n,a)=>{const p=Be("vue-file-agent");return O(),Me(ye,null,[l(Ne),l(Ge,{class:"d-flex justify-center"},{default:r(()=>[l(ae,{cols:"12"},{default:r(()=>[na]),_:1}),l(ae,{class:"text-center",cols:"12"},{default:r(()=>[l(F,{class:"login",onClick:a[0]||(a[0]=e=>B())},{default:r(()=>[D("新增師傅")]),_:1})]),_:1}),l(ae,{cols:"11"},{default:r(()=>[l(ra,{"items-per-page":q.value,"onUpdate:itemsPerPage":[a[2]||(a[2]=e=>q.value=e),T],"sort-by":h.value,"onUpdate:sortBy":[a[3]||(a[3]=e=>h.value=e),T],page:_.value,"onUpdate:page":[a[4]||(a[4]=e=>_.value=e),T],items:H.value,"items-per-page-options":Q,headers:Y,loading:L.value,"items-length":m.value,search:S.value,hover:""},{top:r(()=>[l(E,{class:"w-25",label:"搜尋",modelValue:S.value,"onUpdate:modelValue":a[1]||(a[1]=e=>S.value=e),clearable:"","append-inner-icon":"mdi-magnify","onClick:appendInner":$,onKeydown:Ue($,["enter"]),style:{"margin-left":"auto","margin-right":"1rem"},variant:"underlined"},null,8,["modelValue"])]),"item.image[0]":r(({item:e})=>[l(he,{src:e.image[0],height:"50px"},null,8,["src"])]),"item.sell":r(({item:e})=>[e.sell?(O(),X(Fe,{key:0,icon:"mdi-check",color:"green"})):_e("",!0)]),"item.edit":r(({item:e})=>[l(F,{icon:"mdi-pencil",variant:"text",color:"#d9d5d2",onClick:u=>B(e)},null,8,["onClick"])]),_:2},1032,["items-per-page","sort-by","page","items","loading","items-length","search"])]),_:1})]),_:1}),z.value?(O(),X(te,{key:0,class:"w-75",modelValue:x.value,"onUpdate:modelValue":a[12]||(a[12]=e=>x.value=e),persistent:""},{default:r(()=>[l(me,{disabled:t(b),onSubmit:ie(t(N),["prevent"])},{default:r(()=>[l(oe,null,{default:r(()=>[l(se,null,{default:r(()=>[D(re(i.value===""?"新增師傅":"編輯師傅"),1)]),_:1}),l(ue,null,{default:r(()=>[l(E,{label:"姓名",modelValue:t(V).value.value,"onUpdate:modelValue":a[5]||(a[5]=e=>t(V).value.value=e),"error-messages":t(V).errorMessage.value},null,8,["modelValue","error-messages"]),l(E,{label:"價格/1H",modelValue:t(f).value.value,"onUpdate:modelValue":a[6]||(a[6]=e=>t(f).value.value=e),"error-messages":t(f).errorMessage.value},null,8,["modelValue","error-messages"]),l(be,{label:"分類",items:M,modelValue:t(P).value.value,"onUpdate:modelValue":a[7]||(a[7]=e=>t(P).value.value=e),"error-messages":t(P).errorMessage.value},null,8,["modelValue","error-messages"]),l(Ve,{label:"上架",modelValue:t(k).value.value,"onUpdate:modelValue":a[8]||(a[8]=e=>t(k).value.value=e),"error-messages":t(k).errorMessage.value},null,8,["modelValue","error-messages"]),l(fe,{label:"說明",modelValue:t(y).value.value,"onUpdate:modelValue":a[9]||(a[9]=e=>t(y).value.value=e),"error-messages":t(y).errorMessage.value},null,8,["modelValue","error-messages"]),l(p,{modelValue:d.value,"onUpdate:modelValue":a[10]||(a[10]=e=>d.value=e),rawModelValue:U.value,"onUpdate:rawModelValue":a[11]||(a[11]=e=>U.value=e),accept:"image/jpeg,image/png",deletable:"","error-text":{type:"檔案格式不支援",size:"檔案超過 1 MB 限制"},"help-text":"選擇檔案或拖曳到這","max-files":3,"max-size":"1MB",ref_key:"fileAgent",ref:R},null,8,["modelValue","rawModelValue"])]),_:1}),l(ne,null,{default:r(()=>[l(de),l(F,{color:"red",disabled:t(b),onClick:A},{default:r(()=>[D("取消")]),_:1},8,["disabled"]),l(F,{color:"green",type:"submit",loading:t(b)},{default:r(()=>[D("送出")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"])):(O(),X(te,{key:1,class:"w-50",modelValue:x.value,"onUpdate:modelValue":a[20]||(a[20]=e=>x.value=e),persistent:""},{default:r(()=>[l(me,{disabled:t(b),onSubmit:ie(t(N),["prevent"])},{default:r(()=>[l(oe,null,{default:r(()=>[l(se,null,{default:r(()=>[D(re(i.value===""?"新增師傅":"編輯師傅"),1)]),_:1}),l(ue,null,{default:r(()=>[l(E,{label:"姓名",modelValue:t(V).value.value,"onUpdate:modelValue":a[13]||(a[13]=e=>t(V).value.value=e),"error-messages":t(V).errorMessage.value},null,8,["modelValue","error-messages"]),l(E,{label:"價格/1H",modelValue:t(f).value.value,"onUpdate:modelValue":a[14]||(a[14]=e=>t(f).value.value=e),"error-messages":t(f).errorMessage.value},null,8,["modelValue","error-messages"]),l(be,{label:"分類",items:M,modelValue:t(P).value.value,"onUpdate:modelValue":a[15]||(a[15]=e=>t(P).value.value=e),"error-messages":t(P).errorMessage.value},null,8,["modelValue","error-messages"]),l(Ve,{label:"上架",modelValue:t(k).value.value,"onUpdate:modelValue":a[16]||(a[16]=e=>t(k).value.value=e),"error-messages":t(k).errorMessage.value},null,8,["modelValue","error-messages"]),l(fe,{label:"說明",modelValue:t(y).value.value,"onUpdate:modelValue":a[17]||(a[17]=e=>t(y).value.value=e),"error-messages":t(y).errorMessage.value},null,8,["modelValue","error-messages"]),l(p,{modelValue:d.value,"onUpdate:modelValue":a[18]||(a[18]=e=>d.value=e),rawModelValue:U.value,"onUpdate:rawModelValue":a[19]||(a[19]=e=>U.value=e),multiple:"",accept:"image/jpeg,image/png",deletable:"","error-text":{type:"檔案格式不支援",size:"檔案超過 1 MB 限制"},"help-text":"選擇檔案或拖曳到這","max-files":3,"max-size":"1MB",ref_key:"fileAgent",ref:R},null,8,["modelValue","rawModelValue"])]),_:1}),l(ne,null,{default:r(()=>[l(de),l(F,{color:"red",disabled:t(b),onClick:A},{default:r(()=>[D("取消")]),_:1},8,["disabled"]),l(F,{color:"green",type:"submit",loading:t(b)},{default:r(()=>[D("送出")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["disabled","onSubmit"])]),_:1},8,["modelValue"]))],64)}}},wa=Te(da,[["__scopeId","data-v-c3b38176"]]);export{wa as default};
